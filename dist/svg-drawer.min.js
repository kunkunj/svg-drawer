!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self)["svg-drawer"]={})}(this,(function(t){"use strict";const e="http://www.w3.org/2000/svg",i="L",s="M",o=(t,i,s,o,n)=>{const a=document.createElementNS(e,"svg");return a.setAttribute("style",`position: absolute;\n    transform-origin: 0 0;\n    width:${i*o}px;\n    height:${s*o}px;\n    user-select:none;\n    left: 0;\n    right: 0;\n    background: #fbf8f8;`),t.style.position="relative",t.style.overflow="hidden",t.style.width=i+"px",t.style.height=s+"px",t.style.border="1px solid #ccc",t.appendChild(a),function(t,e,i){let s,o,n,a=1;function r(e){e.wheelDelta>0?a+=.1:a=a>=.6?a-.1:.5,t.style.transform=`scale(${a})`}function h(){n=!1}t.addEventListener("mousewheel",r),window.addEventListener("mouseup",h),t.onmousedown=function(t){s=t.offsetX*a,o=t.offsetY*a,n=!0},t.onmouseup=h,t.onmousemove=function(a){n&&"none"==i.status&&(t.style.left=a.clientX-e.getBoundingClientRect().left-s+"px",t.style.top=a.clientY-e.getBoundingClientRect().top-o+"px")}}(a,t,n),a};const n=(t,e=1)=>{function i(t){return e<-1?t/Math.abs(e):e>1?t*e:t}return t.reduce(((t,e)=>t+` ${e.type} ${i(e.x)} ${i(e.y)}`),"")},a=t=>{let e={};return e.x=t.reduce(((t,e)=>t>e.x?e.x:t),t[0].x),e.y=t.reduce(((t,e)=>t>e.y?e.y:t),t[0].y),e},r=function(t,e,i){let s=[];for(let e=0;e<t.length;e++){const i={};t[e].children&&t[e].children.length&&(i.children=r(t[e].children)),i.dataset=t[e].dataset,i.attributes={},i.tagName=t[e].tagName;for(let s=0;s<t[e].attributes.length;s++)i.attributes[t[e].attributes[s].name]=t[e].attributes[s].value;s.push(i)}return s},{CacheQueue:h,initCache:l,EnterCache:d,OutCache:c}=(()=>{let t=[];return{CacheQueue:t,initCache:e=>{t=new Array(e).map((()=>0))},EnterCache:e=>{t.pop(),t.unshift(e)},OutCache:()=>{t.shift(),t.push(0)}}})();class u{get activeComponet(){return this._ActiveComponet}set activeComponet(t){if("string"!=typeof t){const e=!!this.children.find((e=>e.dataset.id===t.dataset.id));e&&this._ActiveComponet&&(t.setAttribute("stroke",this.activeColor),this._ActiveComponet.setAttribute("stroke",this._ActiveComponet.dataset.line),this._ActiveComponet=t),e||(t.setAttribute("stroke",this.activeColor),this._ActiveComponet=t)}else this._ActiveComponet.setAttribute("stroke",t)}constructor(t,e){if(this.dev=!1,this.children=[],this.idStore={},this.activeColor="rgb(43 219 237)",!t||"object"!=typeof t||!t.tagName)throw new Error("You need to pass in a HTMLElement");this.width=(null==e?void 0:e.width)||500,this.height=(null==e?void 0:e.height)||500,this.cache=(null==e?void 0:e.cache)||5,this.multiple=(null==e?void 0:e.multiple)||2,this._DOM=t,this.status="none",this.init(),l(this.cache)}init(){this.canvas=o(this._DOM,this.width,this.height,this.multiple,this),this.canvas.onclick=t=>{if("line"==this.status){let e=this.activeComponet.getAttribute("d"),o={x:t.offsetX,y:t.offsetY};e?(e+=` ${i} ${t.offsetX} ${t.offsetY}`,o.type=i):(e=`${s} ${t.offsetX} ${t.offsetY}`,o.type=s),this.idStore[this.activeComponet.dataset.id].point.push(o),this.activeComponet.setAttribute("d",e)}}}clearLast(){this._ActiveComponet&&this._ActiveComponet.setAttribute("stroke",this._ActiveComponet.dataset.line)}reStart(t){const e=t||this.activeComponet;return e.setAttribute("stroke",this.activeColor),this.status=e.dataset.type,()=>{this.status="none",this._closeFn(),this.activeComponet=this.activeComponet.dataset.line}}getCanvasContext(){return r(this.children)}setBlank(t){if(t&&(!t.x||!t.y))throw new Error("offset need x and y");this._filterData();let e=[];for(const t in this.idStore)e.push(a(this.idStore[t].point));const i=t||a(e);this.children.map((t=>{const e=((t,e)=>t.map((t=>(t.x=t.x-e.x,t.y=t.y-e.y,t))))(this.idStore[t.dataset.id].point,i);t.setAttribute("d",n(e))}))}_filterData(){this.children=this.children.filter((t=>{var e,i,s;return this.idStore[t.dataset.id].point.length||(null===(e=this.canvas)||void 0===e||e.removeChild(t),delete this.idStore[t.dataset.id]),null===(s=null===(i=this.idStore[t.dataset.id])||void 0===i?void 0:i.point)||void 0===s?void 0:s.length}))}_closeFn(){this.idStore[this.activeComponet.dataset.id].lineStyle.autoClose&&this.idStore[this.activeComponet.dataset.id].point[0]&&(this.idStore[this.activeComponet.dataset.id].point.push({type:i,x:this.idStore[this.activeComponet.dataset.id].point[0].x,y:this.idStore[this.activeComponet.dataset.id].point[0].y}),this.activeComponet.setAttribute("d",n(this.idStore[this.activeComponet.dataset.id].point))),this._filterData(),this.activeComponet=this.activeComponet.dataset.line||"#000"}drawLine(t={}){var i;"line"==this.status&&this._closeFn(),this.status="line",this.clearLast();const s=((t,i,s)=>{const o=document.createElementNS(e,"path");return o.setAttribute("stroke",t),o.setAttribute("stroke-width",t),o.setAttribute("fill",s),o})(t.lineColor||"#000",t.lineWeight,t.fill?t.fill:"transparent");this.activeComponet=s;const o="l"+Date.now();var n,a;return this.idStore[o]={type:"line",lineStyle:t,point:[]},s.setAttribute("data-id",o),s.setAttribute("data-line",t.lineColor||"#000"),s.setAttribute("data-type","line"),a=this,(n=s).style.cursor="pointer",n.onclick=function(){"none"==a.status&&(a.activeComponet=n)},this.children.push(s),null===(i=this.canvas)||void 0===i||i.appendChild(s),()=>{"none"!=this.status&&(this.status="none",this._closeFn())}}}window&&(window.Drawer=u),t.Drawer=u,Object.defineProperty(t,"__esModule",{value:!0})}));
